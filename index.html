<!DOCTYPE html>  <html> <head>   <title>updater.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               updater.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-1">#</a>               </div>               <h2>USO Updater, a Userscripts updater. This file contains all the Javasript logic for the updater.</h2>

<p>Feel free to scroll down for the annotated source code.  </p>

<p>Designed to be simple to use and implement, while also complex and
versitile if needed. There are two interfaces that you will need to
know about:</p>

<ul>
<li>The GET parameter API, where HTTP GET parameters modify this output
file</li>
<li>The Javascript API, which can be observed below.</li>
</ul>

<p>Most people put the updater URL in a <code>@require</code> metadata field within a Userscript, but really, you should
just do whatever you want with it. Yay for freedom. But if you are 'most people', take a look at this sucker:</p>

<pre><code>@require <a href='http://updater.usotools.co.cc/12345.js'>http://updater.usotools.co.cc/12345.js</a>
</code></pre>

<p>A quick GET parameter rundown: (The valid parameters are in bold)
<code><a href='http://updater.usotools.co.cc/'>http://updater.usotools.co.cc/</a><strong>12345</strong>.js?<strong>api</strong>=1&amp;<strong>lang</strong>=en&amp;<strong>interval</strong>=7&amp;<strong>update</strong>=update</code></p>

<h4>Required GET parameters:</h4>

<ul>
<li><strong>12345</strong>: Replace this with your script ID number, good times.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-2">#</a>               </div>               <h4>Optional GET parameters</h4>

<ul>
<li><strong>api</strong>: Want the Javascript API? <code>1</code> for yes, <code>0</code> for no. Simple.</li>
<li><strong>lang</strong>: Set this only if you want everybody to see the same language. Uses a two character language code.
        If you like people seeing the updater in their home language, don't set it. <code>:D</code></li>
<li><strong>interval</strong>: Maximum number of days between updates. Minimum of 1</li>
<li><strong>update</strong>:
<ul><li>update: Direct install without bumping install count. How integral of you!</li>
<li>install: Straight to the goods. Doesn't show the homepage unless your script is
naughty and un-listed. tut tut.</li>
<li>show: The default one. Shows the homepage on update.</li></ul></li>
</ul>

<h3>Credits</h3>

<p>Thanks to the following for ideas / concepts / being cool:</p>

<ul>
<li><a href="http://userscripts.org/users/photodeus">Photodeus</a> - The guy who posted the idea here: <a href='http://userscripts.org/topics/29195'>http://userscripts.org/topics/29195</a></li>
<li><a href="http://userscripts.org/users/anotherjesse">Jesse Andrews</a> - For being a awesome USO host, and giving tips along the way</li>
<li><a href="http://userscripts.org/users/marti">Marti Martz</a> - For arguing ideas to hell and back, then coming to general consensus</li>
<li><a href="http://userscripts.org/users/sizzle">Sizzlemctwizzle</a> - A man full of good ideas</li>
<li>Anyone else I missed, which is probably a lot. Edit your name in here and send me a pull / patch request :p</li>
</ul>

<p><strong>Anyways, onto the Javascript code we go!</strong></p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-3">#</a>               </div>               <p>Create our API reference</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">$api</span> <span class="o">===</span> <span class="kc">true</span> <span class="p">)</span> <span class="p">{</span> <span class="o">?&gt;</span>
<span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">USO</span> <span class="o">!==</span> <span class="s1">&#39;object&#39;</span> <span class="p">)</span>
	<span class="nx">USO</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-4">#</a>               </div>               <p>Anonymous function wrapper to avoid collisions in the sandbox global context</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span> <span class="p">}</span> <span class="o">?&gt;</span>
<span class="p">(</span><span class="kd">function</span><span class="p">(</span> <span class="nx">apiReference</span> <span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-5">#</a>               </div>               <h2>USOScript prototype</h2>

<p>USOScript: contructor Function
A prototype to access various methods for
handling USO User Scripts</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">USOScript</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">construct</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span> <span class="p">);</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">construct</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
	<span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-6">#</a>               </div>               <p>Extend the USOUpdater prototype</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">USOScript</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
	<span class="nx">constructor</span><span class="o">:</span> <span class="nx">USOScript</span><span class="p">,</span>
	<span class="nx">construct</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">scriptID</span> <span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">scriptID</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">scriptID</span> <span class="o">===</span> <span class="s1">&#39;number&#39;</span> <span class="o">?</span> <span class="nx">scriptID</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">scriptID</span><span class="p">;</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-7">#</a>               </div>               <p>Public access to scriptID</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">scriptID</span><span class="o">:</span> <span class="nb">parseInt</span><span class="p">(</span> <span class="s1">&#39;&lt;?=$script_id?&gt;&#39;</span><span class="p">,</span> <span class="mi">10</span> <span class="p">),</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-8">#</a>               </div>               <p>Private remoteMeta</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">_remoteMeta</span><span class="o">:</span> <span class="p">(</span><span class="o">&lt;?=</span><span class="nx">$meta_string</span><span class="o">?&gt;</span><span class="p">),</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-9">#</a>               </div>               <p>Public access to remoteMeta</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">get</span> <span class="nx">remoteMeta</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_remoteMeta</span><span class="p">;</span> <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-10">#</a>               </div>               <p>Private localMeta</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">_localMeta</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-11">#</a>               </div>               <p>Public method of setting local meta</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">set</span> <span class="nx">localMeta</span><span class="p">(</span> <span class="nx">rawE4X</span> <span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">_localMeta</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseMeta</span><span class="p">(</span> <span class="nx">rawE4X</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="p">);</span> <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-12">#</a>               </div>               <p>Public access to localMeta</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">get</span> <span class="nx">localMeta</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_localMeta</span><span class="p">;</span> <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-13">#</a>               </div>               <p>Combined meta. localMeta takes priority over remoteMeta
At present it will will overwrite Object keys completely if
one is present in localMeta.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">get</span> <span class="nx">combinedMeta</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">localMeta</span> <span class="o">===</span> <span class="kc">null</span> <span class="p">)</span>
			<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">remoteMeta</span><span class="p">;</span>

		<span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">{},</span>
			<span class="nx">key</span><span class="p">,</span> <span class="nx">key2</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-14">#</a>               </div>               <p>We don't want to overwrite remoteMeta</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">for</span> <span class="p">(</span> <span class="nx">key</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">remoteMeta</span> <span class="p">)</span>
			<span class="nx">ret</span><span class="p">[</span> <span class="nx">key</span> <span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">remoteMeta</span><span class="p">[</span> <span class="nx">key</span> <span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-15">#</a>               </div>               <p>Do the merge</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">for</span> <span class="p">(</span> <span class="nx">key</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">localMeta</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">localMeta</span><span class="p">[</span> <span class="nx">key</span> <span class="p">]</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">ret</span><span class="p">[</span> <span class="nx">key</span> <span class="p">]</span> <span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">ret</span><span class="p">[</span> <span class="nx">key</span> <span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span> <span class="o">&amp;&amp;</span>
						<span class="nx">ret</span><span class="p">[</span> <span class="nx">key</span> <span class="p">]</span> <span class="k">instanceof</span> <span class="nb">Array</span> <span class="o">===</span> <span class="kc">false</span> <span class="p">)</span> <span class="p">{</span>
					<span class="k">for</span> <span class="p">(</span> <span class="nx">key2</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">localMeta</span><span class="p">[</span> <span class="nx">key</span> <span class="p">]</span> <span class="p">)</span>
						<span class="nx">ret</span><span class="p">[</span> <span class="nx">key</span> <span class="p">][</span> <span class="nx">key2</span> <span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">localMeta</span><span class="p">[</span> <span class="nx">key</span> <span class="p">][</span> <span class="nx">key2</span> <span class="p">];</span>
				<span class="p">}</span> <span class="k">else</span>
					<span class="nx">ret</span><span class="p">[</span> <span class="nx">key</span> <span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">localMeta</span><span class="p">[</span> <span class="nx">key</span> <span class="p">];</span>
			<span class="p">}</span> <span class="k">else</span>
				<span class="nx">ret</span><span class="p">[</span> <span class="nx">key</span> <span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">localMeta</span><span class="p">[</span> <span class="nx">key</span> <span class="p">];</span>
		<span class="p">}</span>

		<span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-16">#</a>               </div>               <p>parseMeta: Function
Parses meta string into a Javascript understandable form</p>

<p>@param    metaString  [String]
            The metadata string to parse</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">parseMeta</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">metaString</span> <span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">{};</span>

		<span class="nx">metaString</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span> <span class="sr">/@(\S+?)(?::(\S+))?(?:[ \t]+([^\r\n]+)|\s+)/g</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">line</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">key2</span><span class="p">,</span> <span class="nx">value</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">key2</span> <span class="o">&amp;&amp;</span> <span class="nx">key2</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">ret</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">!==</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span>
					<span class="nx">ret</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
				<span class="nx">ret</span><span class="p">[</span><span class="nx">key</span><span class="p">][</span><span class="nx">key2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">ret</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span>
				<span class="nx">ret</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">ret</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="nx">value</span><span class="p">];</span>
			<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">ret</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="k">instanceof</span> <span class="nb">Array</span><span class="p">)</span>
				<span class="nx">ret</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
			<span class="k">else</span>
				<span class="nx">ret</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
		<span class="p">}</span> <span class="p">);</span>
		<span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-17">#</a>               </div>               <p>updateRemoteMeta: Function
Updates the remoteMeta from USO</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">updateRemoteMeta</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">callback</span> <span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">fn</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
		<span class="nx">GM_xmlhttpRequest</span><span class="p">({</span>
			<span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;https://userscripts.org/scripts/source/&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">scriptID</span> <span class="o">+</span> <span class="s1">&#39;.meta.js&#39;</span><span class="p">,</span>
			<span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
			<span class="nx">onload</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">xhr</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nx">fn</span><span class="p">.</span><span class="nx">_remoteMeta</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">parseMeta</span><span class="p">(</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span> <span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">callback</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span> <span class="p">)</span>
					<span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">remoteMeta</span> <span class="p">);</span>
				<span class="nx">fn</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">});</span>
	<span class="p">}</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-18">#</a>               </div>               <h2>USOUpdater prototype</h2>

<p>USOUpdater: constructor Function
A prototype that updates a USOScript instance</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">USOUpdater</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">construct</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span> <span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span> <span class="p">);</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">construct</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
	<span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-19">#</a>               </div>               <p>Extend the USOUpdater prototype</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">USOUpdater</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-20">#</a>               </div>               <h2>Private variables / methods</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-21">#</a>               </div>               <p>The max amount in hours</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">var</span> <span class="nx">maxInterval</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span> <span class="s1">&#39;&lt;?=$hours?&gt;&#39;</span><span class="p">,</span> <span class="mi">10</span> <span class="p">),</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-22">#</a>               </div>               <p>The current increment</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">increment</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span> <span class="nx">GM_getValue</span><span class="p">(</span><span class="s1">&#39;uso_updater/last_increment&#39;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">),</span> <span class="mi">10</span> <span class="p">),</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-23">#</a>               </div>               <p>calculateInterval: Function
Calulates a time interval based on a increment</p>

<p>@param    increment   [Number]</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">calculateInterval</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">increment</span><span class="p">,</span> <span class="nx">max</span> <span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">hours</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">exp</span><span class="p">(</span> <span class="nx">increment</span> <span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">exp</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">24</span> <span class="p">)</span> <span class="p">)</span> <span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span> <span class="mi">150</span> <span class="o">&lt;</span> <span class="nx">hours</span> <span class="p">)</span>
			<span class="nx">hours</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span> <span class="nx">hours</span> <span class="o">/</span> <span class="mi">168</span> <span class="p">)</span> <span class="o">*</span> <span class="mi">168</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="mi">20</span> <span class="o">&lt;</span> <span class="nx">hours</span> <span class="p">)</span>
			<span class="nx">hours</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span> <span class="nx">hours</span> <span class="o">/</span> <span class="mi">24</span> <span class="p">)</span> <span class="o">*</span> <span class="mi">24</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span> <span class="nx">hours</span> <span class="o">&gt;=</span> <span class="nx">max</span> <span class="p">)</span>
			<span class="k">return</span> <span class="nx">max</span><span class="p">;</span>

		<span class="k">return</span> <span class="nx">hours</span><span class="p">;</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-24">#</a>               </div>               <p>checkUpdateNeeded: Function
Check interval against last update time</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">checkUpdateNeeded</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">interval</span> <span class="o">=</span> <span class="nx">calculateInterval</span><span class="p">(</span> <span class="nx">increment</span><span class="p">,</span> <span class="nx">maxInterval</span> <span class="p">)</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span> <span class="nx">GM_getValue</span><span class="p">(</span> <span class="s1">&#39;uso_updater/enabled&#39;</span><span class="p">,</span> <span class="kc">true</span> <span class="p">)</span> <span class="o">===</span> <span class="kc">true</span> <span class="o">&amp;&amp;</span>
				<span class="p">(</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">-</span> <span class="nb">parseInt</span><span class="p">(</span> <span class="nx">GM_getValue</span><span class="p">(</span> <span class="s1">&#39;uso_updater/last_update&#39;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">),</span> <span class="mi">10</span> <span class="p">)</span> <span class="o">&gt;=</span> <span class="nx">interval</span> <span class="p">)</span> <span class="p">)</span> <span class="c1">//&#39;</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span> <span class="kc">false</span> <span class="p">);</span>
	<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-25">#</a>               </div>               <h2>Public variables / methods</h2>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="k">return</span> <span class="p">{</span>
	<span class="nx">constructor</span><span class="o">:</span> <span class="nx">USOUpdater</span><span class="p">,</span>
	<span class="nx">construct</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">usoScript</span> <span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">script</span> <span class="o">=</span> <span class="nx">usoScript</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-26">#</a>               </div>               <p>Make sure we are in the correct environment</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">try</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">GM_xmlhttpRequest</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span> <span class="o">&amp;&amp;</span>
					<span class="nx">top</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">===</span> <span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="p">)</span>
				<span class="nx">checkUpdateNeeded</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span> <span class="k">this</span> <span class="p">);</span>
		<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span> <span class="nx">error</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">GM_xmlhttpRequest</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span> <span class="p">)</span>
				<span class="nx">checkUpdateNeeded</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span> <span class="k">this</span> <span class="p">);</span>
		<span class="p">}</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-27">#</a>               </div>               <p>Public access to USOScript Object</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">script</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-28">#</a>               </div>               <p>Return true when enabled, false otherwise</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">get</span> <span class="nx">enabled</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">GM_getValue</span><span class="p">(</span> <span class="s1">&#39;uso_updater/enabled&#39;</span><span class="p">,</span> <span class="kc">false</span> <span class="p">);</span> <span class="p">},</span>
	<span class="nx">set</span> <span class="nx">enabled</span><span class="p">(</span> <span class="kr">boolean</span> <span class="p">)</span> <span class="p">{</span> <span class="nx">GM_setValue</span><span class="p">(</span> <span class="s1">&#39;uso_updater/enabled&#39;</span><span class="p">,</span> <span class="kr">boolean</span> <span class="o">===</span> <span class="kc">true</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span> <span class="p">);},</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-29">#</a>               </div>               <p>Interface for setting script localMeta</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">set</span> <span class="nx">localMeta</span><span class="p">(</span> <span class="nx">rawE4X</span> <span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">script</span><span class="p">.</span><span class="nx">localMeta</span> <span class="o">=</span> <span class="nx">rawE4X</span><span class="p">;</span> <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-30">#</a>               </div>               <p>Contains the localized strings</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">locale</span><span class="o">:</span> <span class="p">(</span><span class="o">&lt;?=</span><span class="nx">$locale_string</span><span class="o">?&gt;</span><span class="p">),</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-31">#</a>               </div>               <p>Contains the update URL to direct to.
Can be changed by user</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">updateUrl</span><span class="o">:</span> <span class="s1">&#39;&lt;?=$update_url?&gt;&#39;</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-32">#</a>               </div>               <p>update: Function
Check to see if an update is needed, then takes action</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">update</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">forced</span> <span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">fn</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
			<span class="nx">previousMeta</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">script</span><span class="p">.</span><span class="nx">remoteMeta</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-33">#</a>               </div>               <p>Fetch meta from USO and check for updates</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">script</span><span class="p">.</span><span class="nx">updateRemoteMeta</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">meta</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span> <span class="k">typeof</span> <span class="nx">meta</span><span class="p">[</span><span class="s1">&#39;uso&#39;</span><span class="p">][</span><span class="s1">&#39;version&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span> <span class="o">&amp;&amp;</span>
					<span class="k">typeof</span> <span class="nx">meta</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span> <span class="o">&amp;&amp;</span>
					<span class="k">typeof</span> <span class="nx">meta</span><span class="p">[</span><span class="s1">&#39;namespace&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span> <span class="p">)</span> <span class="p">{</span>
				<span class="kd">var</span> <span class="nx">details</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">script</span><span class="p">;</span>
				<span class="nx">details</span><span class="p">.</span><span class="nx">newVersion</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span> <span class="nx">meta</span><span class="p">[</span><span class="s1">&#39;uso&#39;</span><span class="p">][</span><span class="s1">&#39;version&#39;</span><span class="p">],</span> <span class="mi">10</span> <span class="p">);</span>
				<span class="nx">details</span><span class="p">.</span><span class="nx">currentVersion</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span> <span class="nx">previousMeta</span><span class="p">[</span><span class="s1">&#39;uso&#39;</span><span class="p">][</span><span class="s1">&#39;version&#39;</span><span class="p">],</span> <span class="mi">10</span> <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-34">#</a>               </div>               <p>Check to see if we have newer version we haven't seen</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">if</span> <span class="p">(</span> <span class="nx">details</span><span class="p">.</span><span class="nx">newVersion</span> <span class="o">&gt;</span> <span class="nx">details</span><span class="p">.</span><span class="nx">currentVersion</span> <span class="o">&amp;&amp;</span>
						<span class="nx">details</span><span class="p">.</span><span class="nx">currentVersion</span> <span class="o">&gt;=</span> <span class="nb">parseInt</span><span class="p">(</span> <span class="nx">GM_getValue</span><span class="p">(</span> <span class="s1">&#39;uso_updater/new_version&#39;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">),</span> <span class="mi">10</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
					<span class="nx">GM_setValue</span><span class="p">(</span> <span class="s1">&#39;uso_updater/last_increment&#39;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">);</span>
					<span class="nx">GM_setValue</span><span class="p">(</span> <span class="s1">&#39;uso_updater/new_version&#39;</span><span class="p">,</span> <span class="nx">details</span><span class="p">.</span><span class="nx">newVersion</span> <span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">forced</span> <span class="o">!==</span> <span class="kc">true</span> <span class="p">)</span>
					<span class="nx">GM_setValue</span><span class="p">(</span> <span class="s1">&#39;uso_updater/last_increment&#39;</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="nx">increment</span> <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-35">#</a>               </div>               <p>See if the name or namespace has changed</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">if</span> <span class="p">(</span> <span class="nx">previousMeta</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">meta</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">||</span>
						<span class="nx">previousMeta</span><span class="p">[</span><span class="s1">&#39;namespace&#39;</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">meta</span><span class="p">[</span><span class="s1">&#39;namespace&#39;</span><span class="p">]</span> <span class="p">)</span>
					<span class="nx">GM_setValue</span><span class="p">(</span> <span class="s1">&#39;uso_updater/enabled&#39;</span><span class="p">,</span> <span class="kc">false</span> <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-36">#</a>               </div>               <p>Trigger the callback</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">fn</span><span class="p">.</span><span class="nx">onUpdate</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">details</span><span class="p">,</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">locale</span><span class="p">,</span> <span class="nx">forced</span> <span class="o">===</span> <span class="kc">true</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span> <span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span>
				<span class="nx">GM_setValue</span><span class="p">(</span> <span class="s1">&#39;uso_updater/enabled&#39;</span><span class="p">,</span> <span class="kc">false</span> <span class="p">);</span>

			<span class="nx">GM_setValue</span><span class="p">(</span> <span class="s1">&#39;uso_updater/last_update&#39;</span><span class="p">,</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span> <span class="p">(</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span> <span class="p">)</span> <span class="p">);</span>
			<span class="nx">fn</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
		<span class="p">}</span> <span class="p">);</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-37">#</a>               </div>               <p>Set to true to enable force updating from menu</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">set</span> <span class="nx">menuUpdate</span><span class="p">(</span> <span class="kr">boolean</span> <span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span> <span class="kr">boolean</span> <span class="o">===</span> <span class="kc">true</span> <span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">fn</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
			<span class="nx">GM_registerMenuCommand</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">script</span><span class="p">.</span><span class="nx">combinedMeta</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">locale</span><span class="p">[</span><span class="s1">&#39;menuCheckUpdates&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">update</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span> <span class="nx">fn</span><span class="p">,</span> <span class="kc">true</span> <span class="p">);</span> <span class="p">}</span> <span class="p">);</span>
		<span class="p">}</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-38">#</a>               </div>               <p>Set to true to enable turning off updater from menu</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">set</span> <span class="nx">menuToggle</span><span class="p">(</span> <span class="kr">boolean</span> <span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span> <span class="kr">boolean</span> <span class="o">===</span> <span class="kc">true</span> <span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">fn</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
			<span class="nx">GM_registerMenuCommand</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">script</span><span class="p">.</span><span class="nx">combinedMeta</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span>
					<span class="k">this</span><span class="p">.</span><span class="nx">locale</span><span class="p">[</span><span class="s1">&#39;menuToggle&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span> <span class="nx">GM_getValue</span><span class="p">(</span> <span class="s1">&#39;uso_updater/enabled&#39;</span><span class="p">,</span> <span class="kc">true</span> <span class="p">)</span> <span class="o">===</span> <span class="kc">true</span> <span class="p">)</span> <span class="p">{</span>
					<span class="nx">alert</span><span class="p">(</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">script</span><span class="p">.</span><span class="nx">combinedMeta</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">locale</span><span class="p">[</span><span class="s1">&#39;updaterOff&#39;</span><span class="p">]</span> <span class="p">);</span>
					<span class="nx">GM_setValue</span><span class="p">(</span> <span class="s1">&#39;uso_updater/enabled&#39;</span><span class="p">,</span> <span class="kc">false</span> <span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="nx">alert</span><span class="p">(</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">script</span><span class="p">.</span><span class="nx">combinedMeta</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">locale</span><span class="p">[</span><span class="s1">&#39;updaterOn&#39;</span><span class="p">]</span> <span class="p">);</span>
					<span class="nx">GM_setValue</span><span class="p">(</span> <span class="s1">&#39;uso_updater/enabled&#39;</span><span class="p">,</span> <span class="kc">true</span> <span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span> <span class="p">);</span>
		<span class="p">}</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-39">#</a>               </div>               <p>onUpdate: Function
The main update callback</p>

<p>@param    details [USOScript Object]
@param    locale  [Object]
            Contains localized strings</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">onUpdate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">details</span><span class="p">,</span> <span class="nx">locale</span><span class="p">,</span> <span class="nx">forced</span> <span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">meta</span> <span class="o">=</span> <span class="nx">details</span><span class="p">.</span><span class="nx">combinedMeta</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">details</span><span class="p">.</span><span class="nx">newVersion</span> <span class="o">&gt;</span> <span class="nx">details</span><span class="p">.</span><span class="nx">currentVersion</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span> <span class="nx">confirm</span><span class="p">(</span> <span class="nx">meta</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nx">locale</span><span class="p">[</span><span class="s1">&#39;updateAvailable&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
				<span class="nx">GM_openInTab</span><span class="p">(</span> <span class="k">this</span><span class="p">.</span><span class="nx">updateUrl</span> <span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">forced</span> <span class="p">)</span>
			<span class="nx">alert</span><span class="p">(</span> <span class="nx">meta</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="nx">locale</span><span class="p">[</span><span class="s1">&#39;updateUnavailable&#39;</span><span class="p">]</span> <span class="p">);</span>
	<span class="p">}</span>
<span class="p">};})();</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-40">#</a>               </div>               <p>End of anonymous function wrapper. Pass in variable to attach ourselves to.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="o">&lt;?</span><span class="nx">php</span> <span class="k">if</span> <span class="p">(</span> <span class="nx">$api</span> <span class="o">===</span> <span class="kc">true</span> <span class="p">)</span> <span class="p">{</span> <span class="o">?&gt;</span>
<span class="nx">apiReference</span><span class="p">.</span><span class="nx">script</span> <span class="o">=</span> <span class="nx">USOScript</span><span class="p">;</span>
<span class="nx">apiReference</span><span class="p">.</span><span class="nx">updater</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">USOUpdater</span><span class="p">(</span> <span class="k">new</span> <span class="nx">USOScript</span><span class="p">()</span> <span class="p">);</span>
<span class="p">})(</span> <span class="nx">USO</span> <span class="p">);</span><span class="o">&lt;?</span><span class="nx">php</span> <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="octowrap">                 <a class="octothorpe" href="#section-41">#</a>               </div>               <p>Call updater</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">else</span> <span class="p">{</span> <span class="o">?&gt;</span>
<span class="k">new</span> <span class="nx">USOUpdater</span><span class="p">(</span> <span class="k">new</span> <span class="nx">USOScript</span><span class="p">()</span> <span class="p">);</span>
<span class="p">})();</span><span class="o">&lt;?</span><span class="nx">php</span> <span class="p">}</span> <span class="o">?&gt;</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 